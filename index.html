<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no" />
  <title>Mindful Maths by Mahak</title>

  <!-- PWA -->
  <link rel="manifest" href="manifest.json" />
  <meta name="theme-color" content="#3d8fc4" />
  <link rel="apple-touch-icon" href="icons/icon-192.png" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent" />

  <link rel="stylesheet" href="style.css" />
</head>
<body>

<header>
  <div class="header-content">
    <img src="icons/icon-192.png" alt="Logo" class="header-logo" />
    <div class="header-text">
      <h1>Mindful Maths</h1>
      <p class="subtitle">by Mahak</p>
    </div>
    <span class="header-planner">Planner</span>
    <button class="header-icon-btn" title="Toggle Notifications" id="notificationBtn">
      <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
        <path d="M18 8A6 6 0 0 0 6 8c0 7-3 9-3 9h18s-3-2-3-9"/>
        <path d="M13.73 21a2 2 0 0 1-3.46 0"/>
      </svg>
    </button>
    <button class="header-icon-btn" title="Achievements" id="achievementsBtn">
      <span class="achievements-icon">üèÜ</span>
      <span class="streak-badge" id="headerStreakBadge">0</span>
    </button>
    <button class="header-icon-btn" title="Backup & Restore" id="backupBtn">
      <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
        <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/>
        <polyline points="7 10 12 15 17 10"/>
        <line x1="12" y1="15" x2="12" y2="3"/>
      </svg>
    </button>
  </div>
</header>

<!-- Navigation Tabs -->
<nav class="tabs">
  <button class="tab active" data-view="schedule">Schedule</button>
  <button class="tab" data-view="students">Students</button>
  <button class="tab" data-view="reports">Reports</button>
</nav>

<!-- Main Schedule View -->
<main id="schedule-view" class="view active">
  <div class="week-header">
    <button id="prevWeek" class="nav-btn">‚óÄ</button>
    <span id="weekLabel">This Week</span>
    <button id="nextWeek" class="nav-btn">‚ñ∂</button>
    <button id="copyWeekBtn" class="copy-week-btn" title="Copy this week's schedule">Copy Week</button>
    <button id="selectModeBtn" class="select-mode-btn" title="Select multiple classes to delete">Delete Multiple</button>
  </div>

  <div id="selectModeBar" class="select-mode-bar hidden">
    <div class="select-mode-info">
      <button id="selectCancelBtn" class="select-cancel-btn">‚úï</button>
      <span><span id="selectedCount">0</span> selected</span>
    </div>
    <div class="select-mode-actions">
      <button id="selectAllBtn" class="select-all-btn">Select All</button>
      <button id="deleteSelectedBtn" class="delete-selected-btn">Delete</button>
    </div>
  </div>

  <div id="dragHint" class="drag-hint hidden">
    <span class="desktop-hint">Drag to move ‚Ä¢ Ctrl/Cmd+drag to copy</span>
    <span class="mobile-hint">Tap class to edit ‚Ä¢ Use copy button to duplicate</span>
  </div>

  <div id="weekGrid" class="week-grid">
    <!-- Days will be rendered here -->
  </div>

  <div id="clashWarning" class="clash-banner hidden">
    ‚ö†Ô∏è Time clashes detected! Check highlighted slots.
  </div>
</main>

<!-- Student View -->
<main id="students-view" class="view">
  <div class="student-selector">
    <label for="studentSelect">Select Student:</label>
    <select id="studentSelect">
      <option value="">-- Choose Student --</option>
    </select>
  </div>

  <div id="studentSchedule" class="student-schedule">
    <p class="empty-state">Select a student to view their weekly schedule</p>
  </div>
</main>

<!-- Reports View -->
<main id="reports-view" class="view">
  <div class="report-header">
    <div class="report-period-selector">
      <button class="period-btn active" data-period="week">This Week</button>
      <button class="period-btn" data-period="month">This Month</button>
      <button class="period-btn" data-period="custom">Custom</button>
    </div>
    <div id="customDateRange" class="custom-date-range hidden">
      <input type="date" id="reportStartDate" />
      <span>to</span>
      <input type="date" id="reportEndDate" />
      <button id="applyDateRange" class="btn btn-sm btn-primary">Apply</button>
    </div>
    <div class="report-navigation">
      <button id="prevReport" class="nav-btn" title="Previous">&#10094;</button>
      <div id="reportPeriodLabel" class="report-period-label">This Week</div>
      <button id="nextReport" class="nav-btn" title="Next">&#10095;</button>
    </div>
  </div>

  <div class="report-summary">
    <div class="summary-card">
      <div class="summary-value" id="totalClasses">0</div>
      <div class="summary-label">Total Classes</div>
    </div>
    <div class="summary-card completed">
      <div class="summary-value" id="completedClasses">0</div>
      <div class="summary-label">Completed</div>
    </div>
    <div class="summary-card upcoming">
      <div class="summary-value" id="upcomingClasses">0</div>
      <div class="summary-label">Upcoming</div>
    </div>
    <div class="summary-card cancelled">
      <div class="summary-value" id="cancelledClasses">0</div>
      <div class="summary-label">Cancelled</div>
    </div>
    <div class="summary-card hours">
      <div class="summary-value" id="totalHours">0</div>
      <div class="summary-label">Total Hours</div>
    </div>
  </div>

  <div class="earnings-chart-container">
    <h3>Weekly Earnings</h3>
    <div class="earnings-total">
      <span class="earnings-label">Total Earned:</span>
      <span class="earnings-value" id="chartTotalEarnings">‚Çπ0</span>
      <span class="earnings-pending" id="chartPendingEarnings">(‚Çπ0 pending)</span>
    </div>
    <div class="earnings-chart" id="earningsChart">
      <!-- Bars will be rendered dynamically -->
    </div>
    <div class="earnings-legend">
      <div class="legend-item"><span class="legend-color paid"></span> Paid</div>
      <div class="legend-item"><span class="legend-color completed"></span> Completed (Unpaid)</div>
      <div class="legend-item"><span class="legend-color upcoming"></span> Upcoming</div>
    </div>
  </div>

  <div class="report-table-container">
    <h3>Classes by Student</h3>
    <table class="report-table" id="studentReportTable">
      <thead>
        <tr>
          <th>Student</th>
          <th>Classes</th>
          <th>Cancelled</th>
          <th>Hours</th>
          <th>Rate (‚Çπ/hr)</th>
          <th>Amount</th>
          <th>Payment</th>
        </tr>
      </thead>
      <tbody id="studentReportBody">
        <!-- Rows will be generated dynamically -->
      </tbody>
      <tfoot id="studentReportFooter">
        <tr>
          <td><strong>Total</strong></td>
          <td id="footerClasses">0</td>
          <td id="footerCancelled">0</td>
          <td id="footerHours">0</td>
          <td>-</td>
          <td id="footerAmount">-</td>
          <td id="footerPayment">-</td>
        </tr>
      </tfoot>
    </table>
  </div>

  <div class="rate-setting">
    <label for="defaultRate">Default Rate (‚Çπ/hr):</label>
    <input type="number" id="defaultRate" value="500" min="0" step="50" />
    <span class="rate-hint">Set individual rates in table above</span>
  </div>
</main>

<!-- Add Class Button -->
<button id="addBtn" class="fab" title="Add Class">+</button>

<!-- Modal for Add/Edit Class -->
<div id="modal" class="modal hidden">
  <div class="modal-content">
    <div class="modal-header">
      <h2 id="modalTitle">Add New Class</h2>
      <button id="closeModal" class="close-btn">&times;</button>
    </div>

    <form id="classForm">
      <div class="form-group">
        <label>Student</label>
        <div id="studentSelectWrapper" class="student-input-wrapper">
          <select id="existingStudentSelect" class="student-select">
            <option value="">-- Select Existing --</option>
          </select>
          <span class="or-divider">or</span>
          <input type="text" id="studentName" placeholder="New student name" autocomplete="off" />
        </div>
      </div>

      <div class="form-group">
        <label for="daySelect">Day</label>
        <select id="daySelect" required>
          <option value="">Select Day</option>
          <option value="Monday">Monday</option>
          <option value="Tuesday">Tuesday</option>
          <option value="Wednesday">Wednesday</option>
          <option value="Thursday">Thursday</option>
          <option value="Friday">Friday</option>
          <option value="Saturday">Saturday</option>
          <option value="Sunday">Sunday</option>
        </select>
      </div>

      <div class="form-group">
        <label>Quick Time Slots</label>
        <div id="quickSlots" class="quick-slots">
          <button type="button" class="quick-slot" data-start="08:00" data-end="09:00">8-9 AM</button>
          <button type="button" class="quick-slot" data-start="09:00" data-end="10:00">9-10 AM</button>
          <button type="button" class="quick-slot" data-start="10:00" data-end="11:00">10-11 AM</button>
          <button type="button" class="quick-slot" data-start="11:00" data-end="12:00">11-12 PM</button>
          <button type="button" class="quick-slot" data-start="14:00" data-end="15:00">2-3 PM</button>
          <button type="button" class="quick-slot" data-start="15:00" data-end="16:00">3-4 PM</button>
          <button type="button" class="quick-slot" data-start="16:00" data-end="17:00">4-5 PM</button>
          <button type="button" class="quick-slot" data-start="17:00" data-end="18:00">5-6 PM</button>
          <button type="button" class="quick-slot" data-start="18:00" data-end="19:00">6-7 PM</button>
          <button type="button" class="quick-slot" data-start="19:00" data-end="20:00">7-8 PM</button>
        </div>
      </div>

      <div class="form-row">
        <div class="form-group">
          <label for="startTime">Start Time</label>
          <input type="time" id="startTime" required />
        </div>
        <div class="form-group">
          <label for="endTime">End Time</label>
          <input type="time" id="endTime" required />
        </div>
      </div>

      <div class="form-group">
        <label>Duration</label>
        <div class="duration-buttons">
          <button type="button" class="duration-btn" data-minutes="30">30 min</button>
          <button type="button" class="duration-btn active" data-minutes="60">1 hr</button>
          <button type="button" class="duration-btn" data-minutes="90">1.5 hr</button>
          <button type="button" class="duration-btn" data-minutes="120">2 hr</button>
        </div>
      </div>

      <div id="formClashWarning" class="form-clash hidden">
        <div class="clash-message">‚ö†Ô∏è This slot clashes with another class!</div>
        <button type="button" id="allowClashBtn" class="allow-clash-btn">Allow Clash</button>
      </div>

      <div id="suggestedSlots" class="suggested-slots hidden">
        <h4>Suggested Available Slots:</h4>
        <div id="slotsList"></div>
      </div>

      <div id="copyToDaySection" class="copy-to-day hidden">
        <label>Copy to other days:</label>
        <div class="day-checkboxes">
          <label class="day-checkbox"><input type="checkbox" value="Monday" /><span>Mon</span></label>
          <label class="day-checkbox"><input type="checkbox" value="Tuesday" /><span>Tue</span></label>
          <label class="day-checkbox"><input type="checkbox" value="Wednesday" /><span>Wed</span></label>
          <label class="day-checkbox"><input type="checkbox" value="Thursday" /><span>Thu</span></label>
          <label class="day-checkbox"><input type="checkbox" value="Friday" /><span>Fri</span></label>
          <label class="day-checkbox"><input type="checkbox" value="Saturday" /><span>Sat</span></label>
          <label class="day-checkbox"><input type="checkbox" value="Sunday" /><span>Sun</span></label>
        </div>
        <button type="button" id="copyToDaysBtn" class="btn btn-secondary btn-sm">Copy to Selected Days</button>
      </div>

      <div id="cancelSection" class="cancel-section hidden">
        <label>Cancel this class:</label>
        <div class="cancel-options">
          <button type="button" class="cancel-reason-btn" data-reason="student">Student Unavailable</button>
          <button type="button" class="cancel-reason-btn" data-reason="tutor">Tutor Unavailable</button>
          <button type="button" class="cancel-reason-btn" data-reason="holiday">Holiday</button>
          <button type="button" class="cancel-reason-btn" data-reason="other">Other Reason</button>
        </div>
      </div>

      <div id="restoreSection" class="restore-section hidden">
        <p>This class was cancelled: <span id="cancelReason"></span></p>
        <div class="restore-actions">
          <button type="button" id="restoreBtn" class="btn btn-success">Restore Class</button>
          <button type="button" id="notifyStudentCancelBtn" class="btn btn-whatsapp">Notify Student</button>
        </div>
      </div>

      <div id="pendingConfirmSection" class="pending-confirm-section hidden">
        <div class="pending-confirm-status">
          <span class="pending-icon">‚è≥</span>
          <span>Awaiting student confirmation</span>
        </div>
        <button type="button" id="confirmClassBtn" class="btn btn-success">Student Confirmed</button>
        <button type="button" id="resendWhatsAppBtn" class="btn btn-secondary btn-sm">Resend WhatsApp</button>
      </div>

      <div class="form-actions">
        <button type="button" id="deleteBtn" class="btn btn-danger hidden">Delete</button>
        <button type="button" id="duplicateBtn" class="btn btn-secondary hidden">Duplicate</button>
        <button type="button" id="checkWithStudentBtn" class="btn btn-whatsapp hidden">Check with Student</button>
        <button type="submit" id="saveBtn" class="btn btn-primary">Save Class</button>
      </div>
    </form>
  </div>
</div>

<!-- Confetti Canvas -->
<canvas id="confettiCanvas"></canvas>

<!-- Achievements Modal -->
<div id="achievementsModal" class="modal hidden">
  <div class="modal-content achievements-modal-content">
    <div class="modal-header">
      <h2>üèÜ Achievements</h2>
      <button class="close-btn" id="closeAchievements">&times;</button>
    </div>
    <div class="streak-section">
      <div class="streak-display">
        <span class="streak-flame">üî•</span>
        <span class="streak-count" id="streakCount">0</span>
        <span class="streak-label">Day Streak</span>
      </div>
      <p class="streak-message" id="streakMessage">Start using the app daily to build your streak!</p>
    </div>
    <div class="badges-section">
      <h3>Badges Earned</h3>
      <div class="badges-grid" id="badgesGrid">
        <!-- Badges will be populated by JS -->
      </div>
    </div>
    <div class="stats-section">
      <h3>All-Time Stats</h3>
      <div class="stats-grid" id="allTimeStats">
        <!-- Stats will be populated by JS -->
      </div>
    </div>
  </div>
</div>

<!-- Achievement Popup -->
<div id="achievementPopup" class="achievement-popup hidden">
  <div class="achievement-content">
    <span class="achievement-icon" id="achievementIcon">üèÜ</span>
    <div class="achievement-text">
      <span class="achievement-label">Achievement Unlocked!</span>
      <span class="achievement-name" id="achievementName">Badge Name</span>
    </div>
  </div>
</div>

<script src="app.js"></script>

<script>
  if ("serviceWorker" in navigator) {
    navigator.serviceWorker.register("service-worker.js");
  }
</script>

</body>
</html>
